(()=>{"use strict";var e,t,n,o,r,c,u=function(e,t){var n=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(r),n.classList.remove(c),n.textContent=""},i=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(o):t.classList.add(o)},a=function(o,a){var s=o.querySelector(n),l=Array.from(o.querySelectorAll(t));e=a.formSelector,t=a.inputSelector,r=a.inputErrorClass,c=a.errorClass,l.forEach((function(e){u(o,e),e.setCustomValidity("")})),i(l,s)},s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"3185e797-84bb-45e6-9886-e50e66f615c9","Content-Type":"application/json"}},l=function(e,t){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:t,headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))};function d(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__image"),i=c.querySelector(".card__title"),a=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-kol"),d=e.name,p=e.link,f=e._id;return i.textContent=d,u.setAttribute("src",p),u.setAttribute("alt",d),a.addEventListener("click",(function(){return t(f,c)})),s.addEventListener("click",(function(){return n(c,s,f)})),u.addEventListener("click",(function(){return o(u)})),void 0===e.likes?l.textContent=0:(l.textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))&&s.classList.add("card__like-button_is-active")),e.owner._id===r&&a.classList.remove("card__delete-button_none"),c}function p(e,t,n){var o=e.querySelector(".card__like-kol");t.classList.contains("card__like-button_is-active")?l(n,"DELETE").then((function(e){o.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):l(n,"PUT").then((function(e){o.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}var f,m,_,v=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");b(t)}},y=function(e){e.querySelector(".popup__close").addEventListener("click",(function(){b(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&b(e)}))},h=function(e){e.classList.add("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keyup",v)},b=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",v)},S=document.querySelector(".places__list"),k=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup_type_edit"),g=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),E=document.forms["edit-profile"],L=E.elements.name,x=E.elements.description,A=document.querySelector(".popup_type_new-card"),j=document.querySelector(".profile__add-button"),P=document.forms["new-place"],U=document.querySelector(".popup_type_image"),D=U.querySelector(".popup__image"),T={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},w={},B=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),O=document.querySelector(".popup_type_del-card"),J=document.forms["del-card"],M=document.querySelector(".popup_type_edit-avatar"),V=document.forms["edit-avatar"],H=document.querySelector(".profile__image"),z=V.elements.link,F=[fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))})),fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))];function G(e){D.setAttribute("src",e.getAttribute("src")),D.setAttribute("alt",e.getAttribute("alt")),h(U)}function I(e,t){w={id:e,cardElement:t},h(O)}Promise.all(F).then((function(e){var t=e[0],n=e[1];f=n._id,m=n.avatar,t.forEach((function(e){S.append(d(e,I,p,G,f))})),B.textContent=n.name,N.textContent=n.about,H.setAttribute("style","background-image: url(".concat(m,")"))})).catch((function(e){console.log(e)})),y(A),y(U),y(q),y(O),y(M),e=(_=T).formSelector,t=_.inputSelector,n=_.submitButtonSelector,o=_.inactiveButtonClass,r=_.inputErrorClass,c=_.errorClass,Array.from(document.querySelectorAll(e)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var o=Array.from(e.querySelectorAll(t)),a=e.querySelector(n);i(o,a),o.forEach((function(t){t.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(r),o.textContent=n,o.classList.add(c)}(e,t,t.validationMessage)})(e,t),i(o,a)}))}))}(e)})),k.addEventListener("click",(function(){L.value=g.textContent,x.value=C.textContent,a(q,T),h(q)})),H.addEventListener("click",(function(){z.value=m,a(M,T),h(M)})),j.addEventListener("click",(function(e){A.querySelector(".popup__form").reset(),a(A,T),h(A)})),P.addEventListener("submit",(function(e){!function(e){var t,n;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=e.target.elements["place-name"].value,n=e.target.elements.link.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){if(e.ok)return e.json()})).then((function(e){return e})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(e){S.prepend(d(e,I,p,G,f)),b(A)})).catch((function(e){console.log(e)})).finally((function(){e.target.querySelector(".popup__button").textContent="Сохранить"}))}(e)})),E.addEventListener("submit",(function(e){!function(e){var t,n;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=L.value,n=x.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(){g.textContent=L.value,C.textContent=x.value,b(q)})).catch((function(e){console.log(e)})).finally((function(){e.target.querySelector(".popup__button").textContent="Сохранить"}))}(e)})),J.addEventListener("submit",(function(e){!function(e){var t;(e.preventDefault(),w.cardElement)&&(t=w.id,fetch("".concat(s.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(){w.cardElement.remove(),b(O),w={}})).catch((function(e){console.log(e)}))}(e)})),V.addEventListener("submit",(function(e){!function(e){var t;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=z.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(){H.setAttribute("style","background-image: url(".concat(z.value,")")),m=z.value,b(M)})).catch((function(e){console.log(e)})).finally((function(){e.target.querySelector(".popup__button").textContent="Сохранить"}))}(e)}))})();