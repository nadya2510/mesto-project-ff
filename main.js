(()=>{"use strict";var e,t,n,o,r,c,u=function(e,t){var n=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(r),n.classList.remove(c),n.textContent=""},a=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(o):t.classList.add(o)},i=function(o,i){var s=o.querySelector(n),l=Array.from(o.querySelectorAll(t));e=i.formSelector,t=i.inputSelector,r=i.inputErrorClass,c=i.errorClass,l.forEach((function(e){u(o,e),e.setCustomValidity("")})),a(l,s)},s={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"3185e797-84bb-45e6-9886-e50e66f615c9","Content-Type":"application/json"}};function l(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__image"),a=c.querySelector(".card__title"),i=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-kol"),d=e.name,p=e.link,f=e._id;return a.textContent=d,u.setAttribute("src",p),u.setAttribute("alt",d),i.addEventListener("click",(function(){return t(f,c)})),s.addEventListener("click",(function(){return n(c,s,f)})),u.addEventListener("click",(function(){return o(u)})),void 0===e.likes?l.textContent=0:(l.textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))&&s.classList.add("card__like-button_is-active")),e.owner._id===r&&i.classList.remove("card__delete-button_none"),c}function d(e,t,n){var o=e.querySelector(".card__like-kol");(function(e,t){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:t,headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))})(n,t.classList.contains("card__like-button_is-active")?"DELETE":"PUT").then((function(e){o.textContent=e.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)}))}var p,f,m,_=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");h(t)}},v=function(e){e.querySelector(".popup__close").addEventListener("click",(function(){h(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&h(e)}))},y=function(e){e.classList.add("popup_is-animated"),e.classList.add("popup_is-opened"),document.addEventListener("keyup",_)},h=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",_)},b=document.querySelector(".places__list"),S=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup_type_edit"),k=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),E=document.forms["edit-profile"],C=E.elements.name,L=E.elements.description,x=document.querySelector(".popup_type_new-card"),A=document.querySelector(".profile__add-button"),j=document.forms["new-place"],P=document.querySelector(".popup_type_image"),U=P.querySelector(".popup__image"),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},T={},w=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),N=document.querySelector(".popup_type_del-card"),O=document.forms["del-card"],J=document.querySelector(".popup_type_edit-avatar"),M=document.forms["edit-avatar"],V=document.querySelector(".profile__image"),H=M.elements.link,z=[fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))})),fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))];function F(e){U.setAttribute("src",e.getAttribute("src")),U.setAttribute("alt",e.getAttribute("alt")),y(P)}function G(e,t){T={id:e,cardElement:t},y(N)}Promise.all(z).then((function(e){var t=e[0],n=e[1];p=n._id,f=n.avatar,t.forEach((function(e){b.append(l(e,G,d,F,p))})),w.textContent=n.name,B.textContent=n.about,V.setAttribute("style","background-image: url(".concat(f,")"))})).catch((function(e){console.log(e)})),v(x),v(P),v(q),v(N),v(J),e=(m=D).formSelector,t=m.inputSelector,n=m.submitButtonSelector,o=m.inactiveButtonClass,r=m.inputErrorClass,c=m.errorClass,Array.from(document.querySelectorAll(e)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var o=Array.from(e.querySelectorAll(t)),i=e.querySelector(n);a(o,i),o.forEach((function(t){t.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(r),o.textContent=n,o.classList.add(c)}(e,t,t.validationMessage)})(e,t),a(o,i)}))}))}(e)})),S.addEventListener("click",(function(){C.value=k.textContent,L.value=g.textContent,i(q,D),y(q)})),V.addEventListener("click",(function(){H.value=f,i(J,D),y(J)})),A.addEventListener("click",(function(e){x.querySelector(".popup__form").reset(),i(x,D),y(x)})),j.addEventListener("submit",(function(e){!function(e){var t,n;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=e.target.elements["place-name"].value,n=e.target.elements.link.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){if(e.ok)return e.json()})).then((function(e){return e})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(e){b.prepend(l(e,G,d,F,p)),h(x)})).catch((function(e){console.log(e)})).finally((function(){e.target.querySelector(".popup__button").textContent="Сохранить"}))}(e)})),E.addEventListener("submit",(function(e){!function(e){var t,n;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=C.value,n=L.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(){k.textContent=C.value,g.textContent=L.value,h(q)})).catch((function(e){console.log(e)})).finally((function(){e.target.querySelector(".popup__button").textContent="Сохранить"}))}(e)})),O.addEventListener("submit",(function(e){!function(e){var t;(e.preventDefault(),T.cardElement)&&(t=T.id,fetch("".concat(s.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:s.headers}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(){T.cardElement.remove(),h(N),T={}})).catch((function(e){console.log(e)}))}(e)})),M.addEventListener("submit",(function(e){!function(e){var t;e.preventDefault(),e.target.querySelector(".popup__button").textContent="Сохранение...",(t=H.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t})}).then((function(e){if(e.ok)return e.json()})).catch((function(e){return Promise.reject("Ошибка: ".concat(res.status))}))).then((function(){V.setAttribute("style","background-image: url(".concat(H.value,")")),f=H.value,h(J)})).catch((function(e){console.log(e)})).finally((function(){e.target.querySelector(".popup__button").textContent="Сохранить"}))}(e)}))})();